If you want to jump straight to the source code, download "google_app_engine_facebook_connect_python.zip":/files/app-engine-facebook-connect/google_app_engine_facebook_connect_python.zip. 

h5. SETUP GOOGLE

To get started, you need to make sure you have signed up for Google App Engine, downloaded the SDK, and added an application to your account. The Google App Engine Launcher is a great way to develop for app engine. It's a convenient tool that allows you to test locally, and deploy to your app engine appspot quickly. For the purpose of our tutorial, we'll refer to the Facebook Connect app engine project as gae-facebook-connect. 

h5. SETUP FACEBOOK

After setting up your Google App Engine account, you'll need to create a "Facebook Application":http://developers.facebook.com/setup.php. Don't worry too much about step 2 (the xd_receiver.html step), as I've included an xd_receiver.html file in the "tutorial zip":/files/app-engine-facebook-connect/google_app_engine_facebook_connect_python.zip at the end of this tutorial. Once we're set up, we need to setup the Facebook Connect URL for our app engine. 

!{width:100%}/img/app-engine-facebook-connect/facebook-connect.png!:/img/app-engine-facebook-connect/facebook-connect.png

h5. INSTALL PYFACEBOOK

Now that we have both Google App Engine and Facebook Connect setup, let's configure Facebook's Python library (appropriately named "PyFacebook":http://wiki.developers.facebook.com/index.php/PyFacebook_Tutorial). In order to use PyFacebook with Google App Engine, you need to make a modification to the __init__.py file in PyFacebook's facebook directory. Add the following code to the Facebook class in __init__.py.

<script src="https://gist.github.com/3775967.js"> </script>

This trick is documented on the "Facebook developer forums":http://forum.developers.facebook.com/viewtopic.php?pid=164613. For convenience, you can copy __init__.py into the root directory of your app engine project (where your main.py is), and call it facebook.py. This is not required, but it's the structure of the "tutorial zip":/files/app-engine-facebook-connect/google_app_engine_facebook_connect_python.zip. 

h5. WRITE APP

Now that we've got the PyFacebook library configured properly, all that's left to do is write our Facebook Connect login app. First, make your app.yaml read like so.

bc. application: gae-facebook-connect
version: 1
runtime: python
api_version: 1

bc. handlers:
- url: /static
  static_dir: static

bc. - url: /.*
  script: main.py

The static directory is where any images, css, js, etc goes. In our case, this is where the xd_receiver.html will sit. The application value should be whatever your application is called on Google App Engine. 

Next, we need to write main.py to.

<script src="https://gist.github.com/3775970.js"> </script>

There is a lot of boilerplate here, but the basic functionality is that MainHandler takes all requests to the root domain. The get() function is called, which is in the BaseHandler. The BaseHandler will check to see if the user is logged in. If the user is logged in, BaseHandler will call get_secure() in MainHandler, which will print the index.html template. If the user is not logged in, BaseHandler will print the login.html template. 

Let's look at login.html.

<script src="https://gist.github.com/3775976.js"> </script>

And now index.html.

<script src="https://gist.github.com/3775978.js"> </script>

It should be fairly obvious what these two html files are doing. If you don't know what XFBML is, read here. 

h5. CONCLUSION

That's all! Just deploy your app, and you should be able to log in and out of your Facebook Connect Google App Engine app. 

h5. LINKS

"google_app_engine_facebook_connect_python.zip":/files/app-engine-facebook-connect/google_app_engine_facebook_connect_python.zip
"Google App Engine":http://code.google.com/appengine/
"Facebook Developer Tools":http://developers.facebook.com/tools.php
"Facebook XFBML":http://wiki.developers.facebook.com/index.php/XFBML
"Facebook Application Setup":http://developers.facebook.com/setup.php
"PyFacebook":http://wiki.developers.facebook.com/index.php/PyFacebook_Tutorial
"PyFacebook App Engine Patch":http://forum.developers.facebook.com/viewtopic.php?pid=164613
